<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>delta.config API documentation</title>
<meta name="description" content="Configuration via YAML files and command line options â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>delta.config</code></h1>
</header>
<section id="section-intro">
<p>Configuration via YAML files and command line options.</p>
<h1 id="delta-configuration-files">DELTA Configuration Files</h1>
<p>DELTA is configured with <a href="https://yaml.org/spec/1.2/spec.html">YAML files</a>. For an example with
all options, showing all parameters DELTA and their default values, see <a href="./delta.yaml">delta.yaml</a>.</p>
<p><code><a title="delta" href="../index.html">delta</a></code> accepts multiple config files on the command line. For example, run</p>
<pre><code class="language-bash">delta train --config dataset.yaml --config train.yaml
</code></pre>
<p>to train on a dataset specified by <code>dataset.yaml</code>:</p>
<pre><code class="language-yaml">dataset:
  images:
    type: tiff
    directory: train/
  labels:
    type: tiff
    directory: labels/
  classes: 2
</code></pre>
<p>with training parameters given in <code>train.yaml</code>:</p>
<pre><code class="language-yaml">train:
  network:
    yaml_file: networks/convpool.yaml
  epochs: 10
</code></pre>
<p>Parameters can be overriden globally for all runs of <code><a title="delta" href="../index.html">delta</a></code> as well, by placing options in
<code>$HOME/.config/delta/delta.yaml</code> on Linux. This is only recommended for global parameters
such as the cache directory.</p>
<p>Most options, aside from the input images and labels, have reasonable defaults. We recommend
only setting the necessary options.
Note that some configuration options can be overwritten on the command line: run
<code>delta --help</code> to see which.</p>
<p>The remainder of this document details the available configuration parameters.</p>
<h2 id="dataset">Dataset</h2>
<p>Images and labels are specified with the <code>images</code> and <code>labels</code> fields respectively,
within <code>dataset</code>. Both share the
same underlying options.</p>
<ul>
<li><code>type</code>: Indicates which <code><a title="delta.imagery.delta_image.DeltaImage" href="../imagery/delta_image.html#delta.imagery.delta_image.DeltaImage">DeltaImage</a></code> image reader to use, e.g., <code>tiff</code> for geotiff.
The reader should previously be registered with <code><a title="delta.config.extensions.register_image_reader" href="extensions.html#delta.config.extensions.register_image_reader">register_image_reader()</a></code>.</li>
<li>Files to load must be specified in one of three ways:<ul>
<li><code>directory</code> and <code>extension</code>: Use all images in the directory ending with the given extension.</li>
<li><code>file_list</code>: Provide a text file with one image file name per line.</li>
<li><code>files</code>: Provide a list of file names in yaml.</li>
</ul>
</li>
<li><code>preprocess</code>: Specify a preprocessing chain. We recommend
scaling input imagery in the range 0.0 to 1.0 for best results with most of our networks.
DELTA also supports custom preprocessing commands. Default actions include:<ul>
<li><code>scale</code> with <code>factor</code> argument: Divide all values by amount.</li>
<li><code>offset</code> with <code>factor</code> argument: Add <code>factor</code> to pixel values.</li>
<li><code>clip</code> with <code>bounds</code> argument: clip all pixels to bounds.
Preprocessing commands are registered with <code><a title="delta.config.extensions.register_preprocess" href="extensions.html#delta.config.extensions.register_preprocess">register_preprocess()</a></code>.
A full list of defaults (and examples of how to create new ones) can be found in <code><a title="delta.extensions.preprocess" href="../extensions/preprocess.html">delta.extensions.preprocess</a></code>.</li>
</ul>
</li>
<li><code>nodata_value</code>: A pixel value to ignore in the images. Will try to determine from the file if this is not specified.</li>
<li><code>classes</code>: Either an integer number of classes or a list of individual classes. If individual classes are specified,
each list item should be the pixel value of the class in the label images, and a dictionary with the
following potential attributes (see example below):<ul>
<li><code>name</code>: Name of the class.</li>
<li><code>color</code>: Integer to use as the RGB representation for some classification options.</li>
<li><code>weight</code>: How much to weight the class during training (useful for underrepresented classes).</li>
</ul>
</li>
</ul>
<p>As an example:</p>
<pre><code class="language-yaml">dataset:
  images:
    type: tiff
    directory: images/
    preprocess:
      - scale:
          factor: 256.0
    nodata_value: 0
  labels:
    type: tiff
    directory: labels/
    extension: _label.tiff
    nodata_value: 0
  classes:
    - 1:
        name: Cloud
        color: 0x0000FF
        weight: 2.0
    - 2:
        name: Not Cloud
        color: 0xFFFFFF
        weight: 1.0
</code></pre>
<p>This configuration will load tiff files ending in <code>.tiff</code> from the <code>images/</code> directory.
It will then find matching tiff files ending in <code>_label.tiff</code> from the <code>labels</code> directory
to use as labels. The image values will be divied by a factor of 256 before they are used.
(It is often helpful to scale images to a range of 0-1 before training.) The labels represent two classes:
clouds and non-clouds. Since there are fewer clouds, these are weighted more havily. The label
images should contain 0 for nodata, 1 for cloud pixels, and 2 for non-cloud pixels.</p>
<h2 id="train">Train</h2>
<p>These options are used in the <code><a title="delta" href="../index.html">delta</a> train</code> command.</p>
<ul>
<li><code>network</code>: The neural network to train. One of <code>yaml_file</code> or <code>layers</code> must be specified.<ul>
<li><code>yaml_file</code>: A path to a yaml file with only the params and layers fields. See <a href="./networks"><code>delta/config/networks</code></a>
for examples.
<code>yaml
train:
network:
# Create your own custom architecture
yaml_file: path/to/your/custom/architecture/network_architecture.yaml
# Or use an existing architecture included with DELTA
yaml_file: path_to_delta_installation/delta/config/networks/segnet.yaml</code></li>
<li><code>params</code>: A dictionary of parameters to substitute in the <code>layers</code> field.</li>
<li><code>layers</code>: A list of layers which compose the network. See the following section for details.</li>
</ul>
</li>
<li><code>stride</code>: When collecting training samples, skip every <code>n</code> pixels between adjacent blocks. Keep the
default of ~ or 1 to use all available training data. Not used for fully convolutional networks.</li>
<li><code>batch_size</code>: The number of patches to train on at a time. If running out of memory, reducing
batch size may be helpful.</li>
<li><code>max_tile_offset</code>: If given, each epoch, offset all tiles by a random x and y value in the range
(-<code>max_tile_offset</code>, <code>max_tile_offset</code>). Useful for getting different tiles when training. Currently,
this feature is only supported if <code>steps</code> is set as well.</li>
<li><code>steps</code>: If specified, stop training for each epoch after the given number of batches.</li>
<li><code>epochs</code>: the number of times to iterate through all training data during training.</li>
<li><code>loss</code>: <a href="https://keras.io/losses/">Keras loss function</a>. For integer classes, use
<code>sparse_categorical_cross_entropy</code>. May be specified either as a string, or as a dictionary
with arguments to pass to the loss function constructor. Custom losses registered with
<code><a title="delta.config.extensions.register_loss" href="extensions.html#delta.config.extensions.register_loss">register_loss()</a></code> may be used.</li>
<li><code>metrics</code>: A list of <a href="https://keras.io/metrics/">Keras metrics</a> to evaluate. Either the string
name or a dictionary with the constructor arguments may be used. Custom metrics registered with
<code><a title="delta.config.extensions.register_metric" href="extensions.html#delta.config.extensions.register_metric">register_metric()</a></code> or loss functions may also be used.</li>
<li><code>optimizer</code>: The <a href="https://keras.io/optimizers/">Keras optimizer</a> to use. May be specified as a string or
as a dictionary with constructor parameters.</li>
<li><code>callbacks</code>: A list of [Keras callbacks)(<a href="https://keras.io/api/callbacks/">https://keras.io/api/callbacks/</a>) to use during training, specified as
either a string or as a dictionary with constructor parameters. Custom callbacks registered with
<code>delta.config.extensions.register_metric</code> may also be used.</li>
<li><code>validation</code>: Specify validation data. The validation data is tested after each epoch to evaluate the
classifier performance. Always use separate training and validation data!</li>
<li><code>from_training</code> and <code>steps</code>: If <code>from_training</code> is true, take the <code>steps</code> training batches
and do not use it for training but for validation instead. If <code>from_training</code> is false, <code>steps</code> is ignored.</li>
<li><code>images</code> and <code>labels</code>: Specified using the same format as the input data. Use this imagery as testing data
if <code>from_training</code> is false.</li>
</ul>
<h2 id="classify">Classify</h2>
<p>These options are used in the <code><a title="delta" href="../index.html">delta</a> classify</code> command.</p>
<ul>
<li><code>prob_image</code>: If true, save an image with the network outputs as probabilities. Otherwise, map to the most likely class.</li>
<li><code>overlap</code>: If set, apply an overlap to the tiles during classification.</li>
<li><code>regions</code>: A list of region names to look for in WKT files associated with images.</li>
<li><code>wkt_dir</code>: Directory to look for WKT files in.
If not specified they are expected to be in the same folders as input images.</li>
<li><code>metrics</code>: Include either losses or metrics here as specified in the Train section.</li>
</ul>
<p>```Sample config entries:
classify:
regions:
- sample_region_name
- another_region
wkt_dir: /alternate/wkt/location/
metrics: # 2D metrics such as msssim are not supported
- SparseRecall:
label: No Water
name: sparse_recall
binary: true # Sparse metrics are only supported with binary = true
- MappedDice:
mapping:
Water: 1.0
No Water: 0.0
Maybe Water: 0.5
Cloud: 0.0
name: dice </p>
<pre><code>
By default when classify is run with labels available for the input image, it will compute some statistics
across all of the images and also on a per-image basis. You can also provide a WKT formatted shape file for
each input image containing one or more polygons/multipolygons, each with one or more region names. For each
region name specified in the config file, all regions including this name will have their statistics jointly
computed. In addition, all regions without a name will have their statistics individually computed. WKT files
should have the same names as their associated image files but with the extension &quot;.wkt.csv&quot;.  There is a sample WKT file, along with a picture of the described regions, [here](../../docs/sample.wkt.csv)

### Network

For the &lt;code&gt;layers&lt;/code&gt; attribute, any [Keras Layer](https://keras.io/api/layers/) can
be used, including custom layers registered with &lt;code&gt;&lt;a title=&quot;delta.config.extensions.register_layer&quot; href=&quot;extensions.html#delta.config.extensions.register_layer&quot;&gt;register\_layer()&lt;/a&gt;&lt;/code&gt;.  

Sub-fields of the layer are argument names and values which are passed to the layer's constructor.  

A special sub-field, &lt;code&gt;inputs&lt;/code&gt;, is a list of the names of layers to pass as inputs to this layer.
If &lt;code&gt;inputs&lt;/code&gt; is not specified, the previous layer is used by default. Layer names can be specified &lt;code&gt;name&lt;/code&gt;.

```yaml
layers:
  Input:
    shape: [~, ~, num_bands]
    name: input
  Add:
    inputs: [input, input]
</code></pre>
<p>This simple example takes an input and adds it to itself.</p>
<p>Since this network takes inputs of variable size ((~, ~, <code>num_bands</code>) is the input shape) it is a <strong>fully
convolutional network</strong>. This means that during training and classification, it will be evaluated on entire
tiles rather than smaller chunks.</p>
<p>A few special parameters are available by default:</p>
<ul>
<li><code>num_bands</code>: The number of bands / channels in an image.</li>
<li><code>num_classes</code>: The number of classes provided in dataset.classes.</li>
</ul>
<h2 id="mlflow">Mlflow</h2>
<p>Used in the <code><a title="delta" href="../index.html">delta</a> train</code> and <code><a title="delta" href="../index.html">delta</a> mlflow_ui</code> commands to keep track of training runs using MLFlow.</p>
<ul>
<li><code>enabled</code>: Turn MLFlow use off or on.</li>
<li><code>uri</code>: The URI for where MLFlow should store tracking runs. Options such as file directories, databases,
and HTTP servers are supported. See the
<a href="https://www.mlflow.org/docs/latest/tracking.html"><code>mlflow.set_tracking_uri()</code></a>
documentation for details.</li>
<li><code>experiment_name</code>: A name for the experiment to track in MLFlow.</li>
<li><code>frequency</code>: Record metrics after this many batches. Want to pick a number that won't slow down training or
use too much disk space.</li>
<li><code>checkpoints</code>: Configure saving of checkpoint networks to mlflow, in case something goes wrong or to compare
networks from different stages of training.</li>
<li><code>frequency</code>: Frequency in epochs to save a checkpoint. Networks can require a fair amount of disk space,
so don't save too often.</li>
<li><code>only_save_latest</code>: If true, only keep the network file from the most recent checkpoint.</li>
</ul>
<h2 id="tensorboard">Tensorboard</h2>
<p><a href="https://www.tensorflow.org/tensorboard">Tensorboard</a> is TensorFlow's visualization toolkit.</p>
<ul>
<li><code>enabled</code>: Set to true to save data to tensorboard. Disabled by default.</li>
<li><code>dir</code>: Specify a directory to save tensorboard data.</li>
</ul>
<h2 id="general">General</h2>
<ul>
<li><code>gpus</code>: The number of GPUs to use, or <code>-1</code> for all.</li>
<li><code>verbose</code>: Trigger verbose printing.</li>
<li><code><a title="delta.config.extensions" href="extensions.html">delta.config.extensions</a></code>: List of extensions to load. Add custom modules here and they will be loaded when
delta starts.</li>
</ul>
<h2 id="io">I/O</h2>
<ul>
<li><code>threads</code>: The number of threads to use for loading images into tensorflow.</li>
<li><code>tile_size</code>: The size of a tile to load into memory at a time. For fully convolutional networks, the
entire tile will be processed at a time, for others it will be chunked.</li>
<li><code>interleave_blocks</code>: When training, interleave tiles from this number of blocks at a time. Generally
higher is better, but limited by memory.</li>
<li><code>cache</code>: Options for a cache, which is used by a few image types (currently worldview and landsat).<ul>
<li><code>dir</code>: Directory to store the cache. <code>default</code> gives a reasonable OS-specific default.</li>
<li><code>limit</code>: Maximum number of items to store in the cache before deleting old entries.
Access the singleton <code><a title="delta.config.config" href="config.html">delta.config.config</a></code> to get configuration
values, specified either in YAML files or on the command line,
and to load additional YAML files.</li>
</ul>
</li>
</ul>
<p>For a list of all options and their defaults, see
<code>delta/config/delta.yaml</code>.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright Â© 2020, United States Government, as represented by the
# Administrator of the National Aeronautics and Space Administration.
# All rights reserved.
#
# The DELTA (Deep Earth Learning, Tools, and Analysis) platform is
# licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#        http://www.apache.org/licenses/LICENSE-2.0.
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

&#34;&#34;&#34;
Configuration via YAML files and command line options.

.. include:: README.md

Access the singleton `delta.config.config` to get configuration
values, specified either in YAML files or on the command line,
and to load additional YAML files.

For a list of all options and their defaults, see
`delta/config/delta.yaml`.
&#34;&#34;&#34;

from .config import config, DeltaConfigComponent, validate_path, validate_positive, validate_non_negative</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="delta.config.config" href="config.html">delta.config.config</a></code></dt>
<dd>
<div class="desc"><p>Loading configuration from command line arguments and yaml files â€¦</p></div>
</dd>
<dt><code class="name"><a title="delta.config.extensions" href="extensions.html">delta.config.extensions</a></code></dt>
<dd>
<div class="desc"><p>Manage extensions to DELTA â€¦</p></div>
</dd>
<dt><code class="name"><a title="delta.config.modules" href="modules.html">delta.config.modules</a></code></dt>
<dd>
<div class="desc"><p>Registers all config modules.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#delta-configuration-files">DELTA Configuration Files</a><ul>
<li><a href="#dataset">Dataset</a></li>
<li><a href="#train">Train</a></li>
<li><a href="#classify">Classify</a></li>
<li><a href="#mlflow">MLFlow</a></li>
<li><a href="#tensorboard">TensorBoard</a></li>
<li><a href="#general">General</a></li>
<li><a href="#io">I/O</a></li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="delta" href="../index.html">delta</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="delta.config.config" href="config.html">delta.config.config</a></code></li>
<li><code><a title="delta.config.extensions" href="extensions.html">delta.config.extensions</a></code></li>
<li><code><a title="delta.config.modules" href="modules.html">delta.config.modules</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>